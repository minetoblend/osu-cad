<template>
  <svg class="loading-icon" viewBox="0 0 62 28">
    <g id="logo-image">
      <circle
        id="logo-sliderhead"
        r="3.25"
        cx="4"
        cy="12"
        fill="white"
        stroke="red"
        stroke-width="1.5"
      />

      <path
        id="logo-sliderbody"
        :d="arcPath"
        stroke-linecap="round"
        stroke-width="1.5"
        stroke-linejoin="round"
      />

      <path
        id="logo-cursor"
        d="M13.936 13.8204L11.3463 7.34629L17.8204 9.93595L15.5 10.7094C15.1267 10.8338 14.8338 11.1267 14.7094 11.5L13.936 13.8204Z"
        fill="#63E2B7"
        fill-opacity="0.25"
        stroke="#63E2B7"
        stroke-width="1.5"
        stroke-miterlimit="11.4737"
        stroke-linejoin="round"
      />
    </g>

    <g id="logo-text">
      <path
        d="M25.444 12.096C24.932 12.096 24.504 12.064 24.16 12C23.824 11.936 23.556 11.836 23.356 11.7C23.164 11.556 23.02 11.364 22.924 11.124C22.836 10.884 22.776 10.584 22.744 10.224C22.72 9.864 22.708 9.432 22.708 8.928C22.708 8.432 22.72 8.004 22.744 7.644C22.776 7.284 22.836 6.984 22.924 6.744C23.02 6.504 23.164 6.316 23.356 6.18C23.556 6.036 23.824 5.936 24.16 5.88C24.504 5.816 24.932 5.784 25.444 5.784C25.964 5.784 26.392 5.816 26.728 5.88C27.072 5.936 27.34 6.036 27.532 6.18C27.732 6.316 27.876 6.504 27.964 6.744C28.06 6.984 28.12 7.284 28.144 7.644C28.176 8.004 28.192 8.432 28.192 8.928C28.192 9.432 28.176 9.864 28.144 10.224C28.12 10.584 28.06 10.884 27.964 11.124C27.876 11.364 27.732 11.556 27.532 11.7C27.34 11.836 27.072 11.936 26.728 12C26.392 12.064 25.964 12.096 25.444 12.096ZM25.444 11.028C25.812 11.028 26.096 11.004 26.296 10.956C26.496 10.908 26.636 10.812 26.716 10.668C26.804 10.524 26.856 10.312 26.872 10.032C26.896 9.752 26.908 9.384 26.908 8.928C26.908 8.472 26.896 8.108 26.872 7.836C26.856 7.556 26.804 7.344 26.716 7.2C26.636 7.056 26.496 6.964 26.296 6.924C26.096 6.876 25.812 6.852 25.444 6.852C25.084 6.852 24.804 6.876 24.604 6.924C24.404 6.964 24.26 7.056 24.172 7.2C24.092 7.344 24.04 7.556 24.016 7.836C24 8.108 23.992 8.472 23.992 8.928C23.992 9.384 24 9.752 24.016 10.032C24.04 10.312 24.092 10.524 24.172 10.668C24.26 10.812 24.404 10.908 24.604 10.956C24.804 11.004 25.084 11.028 25.444 11.028ZM31.9863 12.096C31.7463 12.096 31.4863 12.088 31.2063 12.072C30.9343 12.056 30.6663 12.036 30.4023 12.012C30.1383 11.988 29.9023 11.96 29.6943 11.928V10.92C29.8303 10.928 29.9823 10.94 30.1503 10.956C30.3263 10.972 30.5103 10.984 30.7023 10.992C30.8943 11 31.0823 11.008 31.2663 11.016C31.4503 11.024 31.6303 11.028 31.8063 11.028C32.1903 11.028 32.4663 11.004 32.6343 10.956C32.8103 10.908 32.9223 10.828 32.9703 10.716C33.0263 10.596 33.0543 10.444 33.0543 10.26C33.0543 10.052 33.0343 9.9 32.9943 9.804C32.9623 9.708 32.8983 9.644 32.8023 9.612C32.7063 9.58 32.5583 9.552 32.3583 9.528L30.8703 9.348C30.4863 9.308 30.1943 9.22 29.9943 9.084C29.8023 8.94 29.6703 8.748 29.5983 8.508C29.5343 8.26 29.5023 7.96 29.5023 7.608C29.5023 7.2 29.5583 6.876 29.6703 6.636C29.7903 6.388 29.9543 6.204 30.1623 6.084C30.3783 5.964 30.6383 5.884 30.9423 5.844C31.2463 5.804 31.5783 5.784 31.9383 5.784C32.1623 5.784 32.3943 5.792 32.6343 5.808C32.8823 5.824 33.1183 5.848 33.3423 5.88C33.5743 5.904 33.7743 5.932 33.9423 5.964V6.972C33.7503 6.948 33.5423 6.928 33.3183 6.912C33.0943 6.896 32.8703 6.884 32.6463 6.876C32.4303 6.86 32.2223 6.852 32.0223 6.852C31.7263 6.852 31.4823 6.868 31.2903 6.9C31.0983 6.924 30.9543 6.988 30.8583 7.092C30.7703 7.188 30.7263 7.356 30.7263 7.596C30.7263 7.78 30.7383 7.92 30.7623 8.016C30.7943 8.104 30.8543 8.168 30.9423 8.208C31.0383 8.24 31.1823 8.268 31.3743 8.292L32.9823 8.484C33.2863 8.516 33.5303 8.58 33.7143 8.676C33.9063 8.764 34.0463 8.928 34.1343 9.168C34.2303 9.4 34.2783 9.756 34.2783 10.236C34.2783 10.636 34.2263 10.96 34.1223 11.208C34.0263 11.448 33.8783 11.636 33.6783 11.772C33.4783 11.9 33.2343 11.984 32.9463 12.024C32.6663 12.072 32.3463 12.096 31.9863 12.096ZM37.8309 12.096C37.4069 12.096 37.0589 12.048 36.7869 11.952C36.5229 11.848 36.3189 11.696 36.1749 11.496C36.0389 11.296 35.9469 11.048 35.8989 10.752C35.8509 10.456 35.8269 10.108 35.8269 9.708V5.88H37.0989V9.204C37.0989 9.604 37.1109 9.924 37.1349 10.164C37.1669 10.396 37.2269 10.572 37.3149 10.692C37.4029 10.804 37.5309 10.876 37.6989 10.908C37.8749 10.94 38.1069 10.956 38.3949 10.956C38.7149 10.956 38.9709 10.916 39.1629 10.836C39.3549 10.756 39.4949 10.636 39.5829 10.476C39.6789 10.316 39.7389 10.116 39.7629 9.876C39.7869 9.636 39.7989 9.356 39.7989 9.036V5.88H41.0829V12H39.9069L39.8589 11.184H39.7749C39.6869 11.376 39.5589 11.54 39.3909 11.676C39.2309 11.812 39.0229 11.916 38.7669 11.988C38.5109 12.06 38.1989 12.096 37.8309 12.096ZM45.2673 12.096C44.7953 12.096 44.4033 12.056 44.0913 11.976C43.7873 11.888 43.5433 11.764 43.3593 11.604C43.1753 11.436 43.0393 11.228 42.9513 10.98C42.8633 10.724 42.8033 10.428 42.7713 10.092C42.7473 9.748 42.7353 9.36 42.7353 8.928C42.7353 8.504 42.7513 8.124 42.7833 7.788C42.8153 7.452 42.8793 7.16 42.9753 6.912C43.0793 6.656 43.2233 6.448 43.4073 6.288C43.5913 6.12 43.8313 5.996 44.1273 5.916C44.4233 5.828 44.7953 5.784 45.2433 5.784C45.5313 5.784 45.8313 5.8 46.1433 5.832C46.4633 5.864 46.7273 5.904 46.9353 5.952V6.96C46.7593 6.928 46.5393 6.904 46.2753 6.888C46.0193 6.864 45.7833 6.852 45.5673 6.852C45.2233 6.852 44.9473 6.88 44.7393 6.936C44.5393 6.992 44.3873 7.096 44.2833 7.248C44.1793 7.4 44.1073 7.612 44.0673 7.884C44.0353 8.156 44.0193 8.508 44.0193 8.94C44.0193 9.38 44.0353 9.74 44.0673 10.02C44.1073 10.3 44.1793 10.512 44.2833 10.656C44.3953 10.8 44.5553 10.9 44.7633 10.956C44.9713 11.004 45.2473 11.028 45.5913 11.028C45.7913 11.028 46.0153 11.02 46.2633 11.004C46.5193 10.98 46.7633 10.952 46.9953 10.92V11.928C46.7793 11.976 46.5113 12.016 46.1913 12.048C45.8713 12.08 45.5633 12.096 45.2673 12.096ZM50.0666 12.096C49.6506 12.096 49.2986 12.04 49.0106 11.928C48.7306 11.816 48.5186 11.632 48.3746 11.376C48.2306 11.112 48.1586 10.756 48.1586 10.308C48.1586 9.836 48.2146 9.464 48.3266 9.192C48.4386 8.912 48.6306 8.712 48.9026 8.592C49.1746 8.472 49.5586 8.412 50.0546 8.412C50.1346 8.412 50.2506 8.416 50.4026 8.424C50.5626 8.424 50.7426 8.428 50.9426 8.436C51.1506 8.436 51.3546 8.44 51.5546 8.448C51.7626 8.448 51.9506 8.452 52.1186 8.46V8.172C52.1186 7.86 52.0986 7.616 52.0586 7.44C52.0186 7.264 51.9346 7.136 51.8066 7.056C51.6866 6.968 51.5106 6.912 51.2786 6.888C51.0466 6.864 50.7466 6.852 50.3786 6.852C50.2026 6.852 49.9946 6.86 49.7546 6.876C49.5226 6.884 49.2946 6.896 49.0706 6.912C48.8466 6.928 48.6746 6.948 48.5546 6.972V5.964C48.8826 5.9 49.2426 5.856 49.6346 5.832C50.0266 5.8 50.4186 5.784 50.8106 5.784C51.2666 5.784 51.6466 5.812 51.9506 5.868C52.2626 5.924 52.5146 6.012 52.7066 6.132C52.8986 6.252 53.0426 6.408 53.1386 6.6C53.2346 6.792 53.3026 7.024 53.3426 7.296C53.3826 7.56 53.4026 7.864 53.4026 8.208V12H52.2266L52.1786 11.208H52.1066C51.9706 11.464 51.7866 11.66 51.5546 11.796C51.3306 11.924 51.0866 12.004 50.8226 12.036C50.5586 12.076 50.3066 12.096 50.0666 12.096ZM50.6306 11.064C50.8306 11.064 51.0106 11.052 51.1706 11.028C51.3386 10.996 51.4826 10.948 51.6026 10.884C51.7306 10.812 51.8306 10.716 51.9026 10.596C51.9746 10.46 52.0266 10.304 52.0586 10.128C52.0986 9.952 52.1186 9.744 52.1186 9.504V9.288H50.3666C50.1026 9.288 49.8986 9.308 49.7546 9.348C49.6186 9.388 49.5266 9.472 49.4786 9.6C49.4306 9.728 49.4066 9.924 49.4066 10.188C49.4066 10.436 49.4346 10.624 49.4906 10.752C49.5466 10.872 49.6626 10.956 49.8386 11.004C50.0226 11.044 50.2866 11.064 50.6306 11.064ZM57.2475 12.096C56.8395 12.096 56.4955 12.048 56.2155 11.952C55.9355 11.848 55.7115 11.68 55.5435 11.448C55.3755 11.208 55.2515 10.884 55.1715 10.476C55.0995 10.068 55.0635 9.56 55.0635 8.952C55.0635 8.336 55.0995 7.824 55.1715 7.416C55.2515 7.008 55.3715 6.688 55.5315 6.456C55.6995 6.216 55.9195 6.044 56.1915 5.94C56.4635 5.836 56.7995 5.784 57.1995 5.784C57.4955 5.784 57.7635 5.808 58.0035 5.856C58.2435 5.904 58.4555 5.988 58.6395 6.108C58.8315 6.22 58.9835 6.384 59.0955 6.6H59.1795V3.084H60.4515V12H59.2755L59.2275 11.196H59.1555C59.0355 11.452 58.8715 11.644 58.6635 11.772C58.4635 11.9 58.2395 11.984 57.9915 12.024C57.7435 12.072 57.4955 12.096 57.2475 12.096ZM57.7635 10.968C58.1155 10.968 58.3875 10.924 58.5795 10.836C58.7795 10.74 58.9195 10.592 58.9995 10.392C59.0795 10.208 59.1275 9.996 59.1435 9.756C59.1675 9.516 59.1795 9.236 59.1795 8.916C59.1795 8.612 59.1675 8.348 59.1435 8.124C59.1275 7.892 59.0835 7.696 59.0115 7.536C58.9235 7.32 58.7795 7.164 58.5795 7.068C58.3875 6.972 58.1155 6.924 57.7635 6.924C57.4435 6.924 57.1875 6.948 56.9955 6.996C56.8115 7.036 56.6715 7.124 56.5755 7.26C56.4875 7.388 56.4275 7.588 56.3955 7.86C56.3635 8.124 56.3475 8.484 56.3475 8.94C56.3475 9.396 56.3635 9.76 56.3955 10.032C56.4275 10.296 56.4915 10.496 56.5875 10.632C56.6835 10.768 56.8235 10.86 57.0075 10.908C57.1995 10.948 57.4515 10.968 57.7635 10.968Z"
        fill="#63E2B7"
      />
    </g>
  </svg>
</template>
<script setup lang="ts">
import { computed, onMounted, onUnmounted, watchEffect } from 'vue';
import { Vec2 } from '@osucad/common';

import gsap, { Power2, Power3 } from 'gsap';
import { animate } from '@/editorOld/drawables/animate.ts';

const props = defineProps({
  progress: {
    type: Number,
    required: true,
  },
});

const sliderBodyTimeline = gsap.timeline({ paused: true });
const sliderHeadTimeline = gsap.timeline({ paused: true });
const cursorTimeline = gsap.timeline({ paused: true });
const imageTimeline = gsap.timeline({ paused: true });
const textTimeline = gsap.timeline({ paused: true });

let stopWatcher: () => void;

onMounted(() => {
  sliderBodyTimeline
    .fromTo(
      '#logo-sliderbody',
      {
        opacity: 0,
        stroke: 'white',
        fill: 'white',
      },
      {
        opacity: 0.6,
        stroke: 'white',
        fill: 'white',
        duration: 1,
      },
    )
    .to('#logo-sliderbody', {
      stroke: '#63E2B7',
      fill: 'rgba(99, 226, 183, 0.7)',
      duration: 0.1,
    });

  sliderHeadTimeline
    .fromTo(
      '#logo-sliderhead',
      {
        opacity: 0,
        stroke: 'white',
        fill: 'white',
      },
      {
        opacity: 0.6,
        stroke: 'white',
        fill: 'white',
        duration: 1,
      },
    )
    .to('#logo-sliderhead', {
      opacity: 1,
      stroke: '#63E2B7',
      fill: 'rgba(99, 226, 183, 0.7)',
      duration: 0.1,
    });

  cursorTimeline
    .fromTo(
      '#logo-cursor',
      { x: 6, y: 5, rotation: 20 },
      { x: -2, y: -1, rotation: 0, duration: 1, ease: Power2.easeIn },
    )
    .to('#logo-cursor', {
      x: 0,
      y: 0,
      rotation: 0,
      duration: 1,
      ease: Power2.easeOut,
    });

  imageTimeline.fromTo(
    '#logo-image',
    {
      x: 2,
    },
    {
      x: 0,
      duration: 1,
      ease: Power3.easeOut,
    },
    1,
  );

  textTimeline.fromTo(
    '#logo-text',
    {
      x: -3,
      opacity: 0,
    },
    {
      x: 0,
      opacity: 1,
      duration: 1,
      ease: Power3.easeOut,
    },
    1,
  );

  stopWatcher = watchEffect(() => {
    sliderBodyTimeline.seek(props.progress);
    sliderHeadTimeline.seek(props.progress);
    cursorTimeline.seek(props.progress);
    imageTimeline.seek(props.progress);
    textTimeline.seek(props.progress);
  });
});

const arcPath = computed(() => {
  const startAngle = -2.4;
  const endAngle = animate(props.progress, 0, 1, -2.3, -Math.PI / 2);

  const center = new Vec2(16.2, 17.3);
  const innerRadius = 10;
  const outerRadius = 16.5;
  const startRadius = (outerRadius - innerRadius) / 2 + 2;
  const endRadius = (outerRadius - innerRadius) / 2;

  const inner = new Vec2(innerRadius, 0);
  const outer = new Vec2(outerRadius, 0);

  const p1 = inner.rotate(startAngle + 0.1).add(center);
  const p2 = outer.rotate(startAngle).add(center);
  const p3 = outer.rotate(endAngle).add(center);
  const p4 = inner.rotate(endAngle).add(center);

  const parts: string[] = [
    `M ${p1.x} ${p1.y}`,
    `A ${startRadius} ${startRadius} 0 0 0 ${p2.x} ${p2.y}`,
    `A ${outerRadius} ${outerRadius} 0 0 1 ${p3.x} ${p3.y}`,
    `A ${endRadius} ${endRadius} 0 0 1 ${p4.x} ${p4.y}`,
    `A ${innerRadius} ${innerRadius} 0 0 0 ${p1.x} ${p1.y}`,
  ];

  return parts.join(' ');
});

onUnmounted(() => stopWatcher());
</script>

<style>
.loading-icon {
  width: 100%;
  max-width: min(512px, 40vw);
  max-height: 100%;
}
</style>
